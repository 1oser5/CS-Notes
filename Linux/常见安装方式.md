## 常见安装方式

之前在使用 Linux 系统时，一般都是使用 `yum` 在线安装的，对于其余的安装方式以及原理都没有很深的了解。这次想尝试编写一个一键安装需要软件的 sh 脚本。因此需要了解一下各种安装方式。

目前主流的有这几种：

+ 源码包
+ 二进制包（RPM包）
+ yum在线安装


### 源码包

优点：

+ 开源，如果有足够的能力，可以修改源码
+ 可以自由选择所需内容
+ **软件是编译安装，所以更加适合自己的系统，更稳定高效**
+ 卸载方便


缺点：
+ 安装步骤较多，不适合新手
+ 编译时间较长，安装比二进制安装久



### 二进制包（RPM包）

优点：
+ 包管理系统简单，只需要几个命令就可以实现安装、升级、卸载
+ 安装速度快

缺点：
+ 不能自由选择
+ 经过编译看不到源码
+ 安装依赖问题

### yum在线安装

方便解决二进制包依赖问题，一条命令就可以下载对应的包进行安装

> RedHat的yum是收费服务，而CentOS的yum是免费服务
### 二进制与源码安装位置差异

RPM 包默认安装位置：

![avator](https://raw.githubusercontent.com/1oser5/CS-Notes/master/pic/rpm-default-path.png)


源码包 默认安装位置：

一般是在  `/usr/local/软件名/`，但用户可以高自由的的选择，所有源码安装的服务，只能使用 `绝对路径` 进行服务管理。

所以源码包不能使用 `service` 命令来启动服务，因为源码包的安装位置由用户指定，而 `rpm` 安装之后，通常都是放在 `/etc/rc.d/init.d` 目录中，而 `service` 服务会主动搜索该目录。


### 源码包 安装步骤

1.由于源码是 c语言写的，所以要先安装c语言编译器：gcc

确保有 gcc 编译器
```sh
gcc -v # 是否能打印你使用gcc版本信息
```
下载对应源码包，这里以 `node` 为例

![avator](https://raw.githubusercontent.com/1oser5/CS-Notes/master/pic/node-download.jpg)
最下面的就是源码包

```
wget https://nodejs.org/dist/v12.16.1/node-v12.16.1.tar.gz
```
将其下载至 `/usr/local/src`，进行解压


#### 1.执行 `./configure` 命令

该命令用于软件配置检查，其有以下几点功能：

+ 定义需要的功能选项
+ 检测环境变量是否符合安装要求
+ 把第一项定义好的功能选项和第二项中检测系统环境的信息都写入 `Makefile` 文件（后续的 `make` 和 `make install` 都会依赖该文件）

执行命令 `configure --prefix=/usr/local/node` 将会生成 `Makefile` 文件。`/usr/local/node` 不需要提前创建，第三步会自动创建

#### 2.执行 `make` 命令

编译源码，这一步通常比较耗时


#### 3.执行 `make install` 命令
自动创建 `/usr/local/node`，并安装程序


#### Tips

1.如果 `./configure` 或者 `make` 错误，尝试执行 `make clean` 命令，该命令应用于清除缓存、临时文件等。
2.如果是 `make install` 命令报错，这需要删除 对应文件夹（这里是 `/usr/local/node`），在执行 `make clean` 命令。


### RPM包安装

#### 命名规则
以 httpd 为例
```
httpd-2.2.15-15.el6.centsos.1.i686.rpm
```
`httpd` 是软件包名
`-2.2.15` 是软件版本
`-15` 是发布次数
`centsos` 适合的 Linux 普通
`-i686` 适应的硬件平台
`rpm` 包扩展名
`el6` 是 `redhat` 企业版

#### 依赖问题

+ 树形依赖：`a->b->c`：从后往前安装
+ 环形依赖：`a->b->c->a`在一条命令中安装即可
+ 模块依赖：也叫库文件依赖，它有一个典型的特点，就是以 `.so.数字` 结尾，其实它依赖的是一个文件，而不是软件包。而文件在某个软件包中，因此只要下载对于软件包即可。

yum 安装可以轻松解决以上问题

#### 常见命令

安装命令
```sh
rpm -ivh 包全名
# -i(install) 安装； -v（verbose） 详细信息； -h（hash） 进度；
```

卸载命令
```
rpm -e 包名（比如Httpd，不需要包全名）
```

主要是否需要包全名的区别，如果是已经安装过的 rpm 包，会被存储在 `/var/lib/rpm` 目录中的数据库中，然后卸载命令会查询该数据库，找到对应包卸载。


查询是否安装
`rpm -q 包名`


### yum在线安装

在`/etc/yum.repos.d/`目录中，默认有4个yum源文件，其中`CentOS-Base.repo` 是基本yum源文件，如果我们能上网，那它是默认生效的，而其他的都是默认不生效的。

