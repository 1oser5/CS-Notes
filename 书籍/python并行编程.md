+ [认识并行](认识并行)
  + [介绍](介绍)

# 认识并行

## 介绍

并行程序用多个处理器同时工作，来完成同一个任务。每个处理区都做自己的那部分工作。而且计算过程中处理器之间可能需要交换数据。

提高计算能力有两种思路：提高处理器的时钟速度或者增加芯片上的核心数。提高时钟速度必定会增加散热，然后每瓦特的性能就会降低，甚至可能要求特殊的冷却设备。提高芯片性能的核心数是更可行的一种方法。

因此计算机硬件供应商选择的是多核心的架构，就是在同一个芯片上放两个或者多个处理器。GPU 制造商也引进了这种多处理器核心的硬件架构，所有目前大部分计算机都是多核的。

对我们说充分利用计算资源显得至关重要。

## 并行计算的内存架构

根据指令的同时执行和数据的同时执行，计算机系统分为以下四类：

+ 单处理器，单数据（SISD）
+ 单处理器，多数据（SIMD）
+ 多处理器，单数据（MISD）
+ 多处理器，多数据（MIMD）

![avator](../pic/flynn.png)

这种分类方法叫做 **菲林分类**

### 1.SISD

单处理器单数据就是"单 CPU 的机器"，其在单一数据流上执行指令。在 SISD 中，指令被顺序执行。

对于每一个"CPU 时钟"，CPU 按照下面的顺序执行：
+ Fetch：CPU 从一片内存区域中（寄存器）获取数据和指令
+ Decode：CPU 对该指令进行解码
+ Execute：该指令在数据上执行，将结果保存在另一个寄存器中

当 Execute 阶段完成之后，CPU 回到步骤1准备执行下一个时钟循环。

![avator](../pic/SISD-schema.png)

运行在这些计算机上的算法是顺序执行的（连续的），不存在任何并行。只有一个 CPU 的硬件系统就是 SISD 的例子。

这种架构的主要元素有以下：
+ 中心内存单元：存储指令和数据
+ CPU：用于从内存单元获得指令/数据，对指令解码并顺序执行它们
+ I/O 系统：程序的输入和输出
  
### 2.MISD
这种模型下，有 n 个处理器，每一个都有自己的控制单元，共享一个内存单元。在每一个 CPU 时钟中，从内存获取的数据会被所有的处理器同时处理，每一个处理器按照自己的控制单元发送的指令处理。在这种情况下，并行实际上是指令层面的并行，多个指令在相同的数据上操作。能够合理利用的情况比较少，例如数据加密等。

![avator](../pic/MISD.png)

### 3.SIMD
SIMD 计算机包括多个独立的处理器，每个都有自己的局部内存，用来存放数据。所有处理器在单一指令流下工作。所有的处理器同时处理每一步，在不同的数据上执行相同的指令，这是一个数据并行的例子。SIMD 架构比 MISD 架构要实用的多，这种架构的算法十分容易设计，分析和实现。限制是只有可以被分解为多个小问题的问题才能被这种架构解决。

### 4.MIMD
在菲林分类中，这种计算机是最广泛应用的、也是最强大的种类。这种架构有 n 个处理器， n 个指令流，n 个数据流。每个处理器都有自己的控制单元和局部内存。每个处理器在独立的控制单元分配的指令流下工作。因此，处理器可以在不同的数据上运行不同的程序，这样可以解决完全不同的子问题甚至是单一的大问题。在 MIMD 中，架构是通过线程或者进程层面的并行实现的，这也意味着处理器一般是异步工作的。

![avator](../pic/MIMD.png)


## 内存管理
内存管理是并行架构需要考虑的另一方面，确切来说是获取数据的方式。无论处理单元多块，如果内存提供指令和数据的速度跟不上，系统性能也不会得到提升。制约内存达到处理器速度级别的响应时间主要因素是内存存取周期。

存取周期：连续启动两次读或写操作中所需间隔的最小时间。

处理器的周期通常比内存周期短得多。当处理器传送数据到内存或从内存中获取数据时，内存依旧在一个周期中，在该周期内其他设备不能使用内存。


为了解决 MIMD 架构内存访问的问题，业界提出了两种内存管理系统，共享内存系统 和 分布式内存系统。

### 1.共享内存系统
总线结构允许任意数量的设备共享一个通道。每个处理器都拥有各自的 Cache（缓存），Cache 中保存着局部内存中有可能被处理器使用的指令或数据。

当一个处理器修改了内存中的数据，同时另一个处理器正在使用该数据，就会出现一致性的问题。

![avator](../pic/Cache_Coherency_Generic.png)


1